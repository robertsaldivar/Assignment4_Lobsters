---
title: "Assignment4_Lobsters"
author: "Robert Saldivar"
date: "November 13, 2018"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
#1. Loading Packages and csv files

library(tidyverse)
library(RColorBrewer)
library(ggpubr)
library(knitr)
library(effsize)
library(pwr)
library(extrafont)
library(plotly)
library(ggrepel)
library(kableExtra)
library(onewaytests)
library(car)
library(vcdExtra) #for getting the data into case format
library(xtable)
library(FSA)
library(ggsignif) #to add significance brackets

lobster_size <- read_csv("lobster_size_abundance.csv")
lobster_traps <- read_csv("lobster_traps.csv")
```

```{r, include=FALSE}
#2 Initial Data Editing
lobster_size_edits <- lobster_size %>%
  filter(SIZE !=-99999) %>%
  select(YEAR, SITE, SIZE, COUNT) # Edit Lobster Size data to remove -99999 data from size column and remove transect information
  

lobster_traps_edits <- lobster_traps %>%
  filter(SITE=="AQUE" |SITE =="NAPL" |SITE=="MOHK" |SITE=="IVEE" |SITE=="CARP") %>%
  select(YEAR, SITE, TRAPS)

```

```{r, include=FALSE}
#3 checking data for normality

lobster_size_hist <- ggplot(lobster_size_edits, aes(x=SIZE)) +
  geom_histogram() +
  facet_wrap(~SITE)

lobster_size_hist

lobster_size_qq <- ggplot(lobster_size_edits, aes(sample=SIZE)) +
  geom_qq() +
  facet_wrap(~SITE)

lobster_size_qq

lobster_traps_hist <- ggplot(lobster_traps_edits, aes(x=TRAPS)) +
  geom_histogram() +
  facet_wrap(~SITE)

lobster_traps_hist

lobster_traps_qq <- ggplot(lobster_traps_edits, aes(sample=TRAPS)) +
  geom_qq() +
  facet_wrap(~SITE)

lobster_traps_qq
```

```{r, echo=FALSE, message=FALSE}
#4 create graphs of abundance and fishing pressure from 2012-2017

abundance_col <- ggplot(lobster_size_edits, aes(x=YEAR, y=COUNT)) +
  geom_col() +
  facet_wrap(~SITE)

abundance_col

fishing_pressure_col <- ggplot(lobster_traps_edits, aes(x=YEAR, y=TRAPS)) +
  geom_col() +
  facet_wrap(~SITE)

fishing_pressure_col
```

```{r, include=FALSE}
#5 put lobster size data into case format.

lobster_case_format <- lobster_size_edits %>%
  filter(YEAR=="2017") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")
```

```{r}
#6 run significance tests for lobster size
lobster_levene <- leveneTest(SIZE~SITE, data=lobster_case_format)
lobster_levene
#Variences are not equal check to see if another need to do another test beside anova

lobster_aov <- aov(SIZE~SITE, data=lobster_case_format)
summary(lobster_aov)

lobster_tukeys <- TukeyHSD(lobster_aov)
lobster_tukeys
```

```{r, echo=FALSE}
#7 Creating Graph and table from anova data

lobster_aov_table <- xtable(lobster_aov)
print(lobster_aov_table)

lobster_size_summary <- lobster_case_format %>%
  group_by(SITE) %>%
  summarize(
    lobster_mean = round(mean(SIZE),2),
    lobster_sd = round(sd(SIZE),2),
    sample_size = length(SIZE)
  )

lobster_size_col <- ggplot(lobster_size_summary, aes(x=SITE, y=lobster_mean)) +
  geom_col() +
  geom_errorbar(aes(ymax=lobster_mean+lobster_sd, ymin=lobster_mean-lobster_sd))

lobster_size_col

```

```{r}
# 8 Creating dataframes for lobster size at each site in 2012 and 2017
lobster_NAPL_2012_17 <- lobster_size_edits %>%
  filter(YEAR=="2012" |YEAR=="2017", SITE=="NAPL") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_NAPL_2012 <- lobster_size_edits %>%
  filter(YEAR=="2012", SITE=="NAPL") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_NAPL_2017 <- lobster_size_edits %>%
  filter(YEAR=="2017", SITE=="NAPL") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_IVEE_2012_17 <- lobster_size_edits %>%
  filter(YEAR=="2012" |YEAR=="2017", SITE=="IVEE") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_IVEE_2012 <- lobster_size_edits %>%
  filter(YEAR=="2012", SITE=="IVEE") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_IVEE_2017 <- lobster_size_edits %>%
  filter(YEAR=="2017", SITE=="IVEE") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_AQUE_2012_17 <- lobster_size_edits %>%
  filter(YEAR=="2012" |YEAR=="2017", SITE=="AQUE") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_AQUE_2012 <- lobster_size_edits %>%
  filter(YEAR=="2012", SITE=="AQUE") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_AQUE_2017 <- lobster_size_edits %>%
  filter(YEAR=="2017", SITE=="AQUE") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_MOHK_2012_17 <- lobster_size_edits %>%
  filter(YEAR=="2012" |YEAR=="2017", SITE=="MOHK") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_MOHK_2012 <- lobster_size_edits %>%
  filter(YEAR=="2012", SITE=="MOHK") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_MOHK_2017 <- lobster_size_edits %>%
  filter(YEAR=="2017", SITE=="MOHK") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_CARP_2012_17 <- lobster_size_edits %>%
  filter(YEAR=="2012" |YEAR=="2017", SITE=="CARP") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_CARP_2012 <- lobster_size_edits %>%
  filter(YEAR=="2012", SITE=="CARP") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")

lobster_CARP_2017 <- lobster_size_edits %>%
  filter(YEAR=="2017", SITE=="CARP") %>%
  as.data.frame() %>%
  expand.dft(freq="COUNT")
```

```{r}
#Running f and t tests to see if there is a difference in size at each site between 2012 and 2017

NAPL_ftest <- var.test(lobster_NAPL_2012$SIZE, lobster_NAPL_2017$SIZE)
NAPL_ftest

IVEE_ftest <- var.test(lobster_IVEE_2012$SIZE, lobster_IVEE_2017$SIZE)
IVEE_ftest

AQUE_ftest <- var.test(lobster_AQUE_2012$SIZE, lobster_AQUE_2017$SIZE)
AQUE_ftest

MOHK_ftest <- var.test(lobster_MOHK_2012$SIZE, lobster_MOHK_2017$SIZE)
MOHK_ftest

CARP_ftest <- var.test(lobster_CARP_2012$SIZE, lobster_CARP_2017$SIZE)
CARP_ftest

NAPL_ttest <- t.test(lobster_NAPL_2012$SIZE, lobster_NAPL_2017$SIZE, var.equal=TRUE)
NAPL_ttest

IVEE_ttest <- t.test(lobster_IVEE_2012$SIZE, lobster_IVEE_2017$SIZE, var.equal=TRUE)
IVEE_ttest

AQUE_ttest <- t.test(lobster_AQUE_2012$SIZE, lobster_AQUE_2017$SIZE, var.equal=TRUE)
AQUE_ttest

MOHK_ttest <- t.test(lobster_MOHK_2012$SIZE, lobster_MOHK_2017$SIZE, var.equal=TRUE)
MOHK_ttest

CARP_ttest <- t.test(lobster_CARP_2012$SIZE, lobster_CARP_2017$SIZE, var.equal=TRUE)
CARP_ttest

```

